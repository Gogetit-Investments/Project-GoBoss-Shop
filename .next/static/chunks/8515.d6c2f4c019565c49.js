"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8515],{9406:function(e,n,t){t.d(n,{Z:function(){return c}});var r=t(91131),a=t(10575);function o(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function u(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,o=[],u=!0,i=!1;try{for(t=t.call(e);!(u=(r=t.next()).done)&&(o.push(r.value),!n||o.length!==n);u=!0);}catch(c){i=!0,a=c}finally{try{u||null==t.return||t.return()}finally{if(i)throw a}}return o}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return o(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return o(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var i=(0,r.cn)((0,a.qz)());function c(){var e=u((0,r.KO)(i),2),n=e[0],t=e[1];return{setToken:a.uB,getToken:a.bW,isAuthorized:n,authorize:function(e){(0,a.uB)(e),t(!0)},unauthorize:function(){t(!1),(0,a.H6)()}}}},81109:function(e,n,t){t.r(n);var r=t(85893),a=t(55335),o={STRIPE:{component:t(83167).Z}};n.default=function(){var e=(0,a.X9)().data,n=e.paymentGateway,t=e.paymentIntentInfo,u=e.trackingNumber,i=o[null===n||void 0===n?void 0:n.toUpperCase()],c=null===i||void 0===i?void 0:i.component;return(0,r.jsx)("div",{className:"payment-modal flex h-full min-h-screen w-screen flex-col justify-center bg-light text-left dark:bg-dark-250 xs:h-auto xs:min-h-0 xs:max-w-[400px] md:max-w-[590px] md:rounded-xl lg:max-w-[736px]",children:(0,r.jsx)(c,{paymentIntentInfo:t,trackingNumber:u,paymentGateway:n})})}},83167:function(e,n,t){var r=t(34051),a=t.n(r),o=t(85893),u=t(10268),i=t(86664),c=t(67294),s=t(31932),l=t(74931),d=t(55335),f=t(94631),m=t(89578);function v(e,n,t,r,a,o,u){try{var i=e[o](u),c=i.value}catch(s){return void t(s)}i.done?n(c):Promise.resolve(c).then(r,a)}function y(e){return function(){var n=this,t=arguments;return new Promise((function(r,a){var o=e.apply(n,t);function u(e){v(o,r,a,u,i,"next",e)}function i(e){v(o,r,a,u,i,"throw",e)}u(void 0)}))}}var p=function(e){var n=e.paymentIntentInfo,t=e.trackingNumber,r=(e.paymentGateway,(0,u.$G)("common").t),m=(0,i.useStripe)(),v=(0,i.useElements)(),p=(0,c.useState)(!1),g=p[0],h=p[1],b=(0,c.useState)(!1),_=b[0],x=b[1],P=(0,d.SO)().closeModal,k=(0,s.fY)().createOrderPayment,w=(0,s.MH)().savePaymentMethod,S=(0,c.useState)(""),O=S[0],E=S[1],I=function(){var e=y(a().mark((function e(o){var u,c,s,d,f,p,g,b,x;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.preventDefault(),m&&v){e.next=3;break}return e.abrupt("return");case 3:if(u=v.getElement(i.CardNumberElement),h(!0),!_){e.next=20;break}return e.next=9,m.createPaymentMethod({type:"card",card:u,billing_details:{name:null===o||void 0===o||null===(c=o.target)||void 0===c||null===(s=c.owner_name)||void 0===s?void 0:s.value}});case 9:if(d=e.sent,f=d.error,p=d.paymentMethod,!f){e.next=16;break}E(null===f||void 0===f?void 0:f.message),h(!1),e.next=18;break;case 16:return e.next=18,w({method_key:null===p||void 0===p?void 0:p.id,payment_intent:null===n||void 0===n?void 0:n.payment_id,save_card:_,tracking_number:t},{onSuccess:function(){var e=y(a().mark((function e(o){var u,i,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,m.confirmCardPayment(null===n||void 0===n?void 0:n.client_secret,{payment_method:o.method_key,setup_future_usage:"on_session"});case 3:return i=e.sent,e.next=6,k({tracking_number:t});case 6:"succeeded"===(null===i||void 0===i||null===(u=i.paymentIntent)||void 0===u?void 0:u.status)?(l.ZP.success(r("text-payment-successful")),h(!1),P()):(E(null===i||void 0===i||null===(c=i.error)||void 0===c?void 0:c.message),h(!1));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()});case 18:e.next=27;break;case 20:return e.next=23,m.confirmCardPayment(null===n||void 0===n?void 0:n.client_secret,{payment_method:{card:u}});case 23:return b=e.sent,e.next=26,k({tracking_number:t});case 26:"succeeded"===(null===b||void 0===b||null===(g=b.paymentIntent)||void 0===g?void 0:g.status)?(l.ZP.success(r("text-payment-successful")),h(!1),P()):(E(null===b||void 0===b||null===(x=b.error)||void 0===x?void 0:x.message),h(!1));case 27:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,o.jsx)(f.Z,{handleSubmit:I,type:"checkout",loading:g,cardError:O,changeSaveCard:function(){x(!_)},saveCard:_})};n.Z=function(e){var n=e.paymentGateway,t=e.paymentIntentInfo,r=e.trackingNumber;return(0,o.jsx)(i.Elements,{stripe:(0,m.Z)(),children:(0,o.jsx)(p,{paymentIntentInfo:t,trackingNumber:r,paymentGateway:n})})}},31932:function(e,n,t){t.d(n,{j_:function(){return d},Aj:function(){return f},xp:function(){return m},fY:function(){return v},MH:function(){return y}});var r=t(88767),a=t(21880),o=t(28763),u=t(11163),i=t(55335),c=t(74931);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){s(e,n,t[n])}))}return e}function d(e){var n,t=l({},e),u=(0,r.useInfiniteQuery)([a.P.ORDERS_DOWNLOADS,t],(function(e){var n=e.queryKey,t=e.pageParam;return o.Z.orders.downloadable(Object.assign({},n[1],t))}),{getNextPageParam:function(e){var n=e.current_page;return e.last_page>n&&{page:n+1}}}),i=u.data,c=u.isLoading,s=u.error,d=u.fetchNextPage,f=u.hasNextPage,m=u.isFetching,v=u.isFetchingNextPage;return{downloadableFiles:null!==(n=null===i||void 0===i?void 0:i.pages.flatMap((function(e){return e.data})))&&void 0!==n?n:[],isLoading:c,error:s,hasNextPage:f,isFetching:m,isLoadingMore:v,loadMore:function(){d()}}}function f(e){var n=e.tracking_number,t=(0,r.useQuery)([a.P.ORDERS,n],(function(){return o.Z.orders.get(n)}),{refetchOnWindowFocus:!1}),u=t.data,i=t.isLoading,c=t.error;return{order:u,isFetching:t.isFetching,isLoading:i,refetch:t.refetch,error:c}}function m(e){var n=e.tracking_number,t=(0,u.useRouter)(),c=(0,i.SO)().openModal,s=(0,r.useQuery)([a.P.PAYMENT_INTENT,{tracking_number:n}],(function(){return o.Z.orders.getPaymentIntent({tracking_number:n})}),{enabled:!1,onSuccess:function(e){var n,r;if(null===e||void 0===e||null===(n=e.payment_intent_info)||void 0===n?void 0:n.is_redirect)return t.push(null===e||void 0===e||null===(r=e.payment_intent_info)||void 0===r?void 0:r.redirect_url);c("PAYMENT_MODAL",{paymentGateway:null===e||void 0===e?void 0:e.payment_gateway,paymentIntentInfo:null===e||void 0===e?void 0:e.payment_intent_info,trackingNumber:null===e||void 0===e?void 0:e.tracking_number})}}),l=s.data,d=s.isLoading,f=s.error;return{data:l,getPaymentIntentQuery:s.refetch,isLoading:d,error:f}}function v(){var e=(0,r.useQueryClient)(),n=(0,r.useMutation)(o.Z.orders.payment,{onSettled:function(n){e.refetchQueries(a.P.ORDERS),e.refetchQueries(a.P.ORDERS_DOWNLOADS)},onError:function(e){var n=(null!==e&&void 0!==e?e:{}).response.data;c.ZP.error(null===n||void 0===n?void 0:n.message)}}),t=n.mutate;return{createOrderPayment:function(e){var n=l({},e);t(n)},isLoading:n.isLoading}}function y(){var e=(0,r.useMutation)(o.Z.orders.savePaymentMethod),n=e.mutate,t=e.isLoading,a=e.error;return{savePaymentMethod:n,data:e.data,isLoading:t,error:a}}},66639:function(e,n,t){t.d(n,{P:function(){return i},a:function(){return c}});var r=t(9406),a=t(88767),o=t(28763),u=t(21880);function i(){var e=(0,r.Z)().isAuthorized,n=(0,a.useQuery)([u.P.USERS_ME],o.Z.users.me,{enabled:e});return{me:n.data,isLoading:n.isLoading,error:n.error,isAuthorized:e}}function c(){var e=(0,r.Z)().unauthorize,n=(0,a.useQueryClient)();return(0,a.useMutation)(o.Z.users.logout,{onSuccess:function(){e(),n.resetQueries(u.P.USERS_ME)}})}}}]);